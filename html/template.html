<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tool Title</title>
    <link id="app-favicon" rel="icon" href="data:,">

    <!-- Local requests section -->

    <script>
    // Fonts: objects (url + font metadata)
    var requiredFonts = [
      {
        url: "fonts/C64ProMono.woff2",
        family: "C64ProMono",
        weight: "normal",
        style: "normal",
        display: "swap",
        format: "woff2"
      }
    ];

    // CSS: objects with url
    var requiredCSS = [
      // { url: "css/mem-tool.css" }
    ];


    // JS: objects with url
    var requiredJS = [
      // { url: "js/ui-components.js" },
      // { url: "js/api-client.js" },
      // { url: "js/tab-lifecycle.js" }
    ];

    // UI selectors to disable during load
    var contentItems = [
      ".tab-content",
      ".tab-bar"
    ];
    </script>

    <!-- External requests section -->

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- Inline CSS Styles section -->

    <style>
    /* common-inline.css - Shared styles for C64U Web Control Panel */

    :root {
        /* Colors */
        --primary: #3498db;
        --success: #2ecc71;
        --danger: #e74c3c;
        --warning: #ff9800;
        --bg: #1a1c1e;
        --card-bg: #25282c;
        --text: #e0e0e0;
        --text-dim: #a0a0a0;
        --border: #3a3f44;
        --input-bg: #2d3136;

        /* Spacing */
        --spacing-xs: 5px;
        --spacing-sm: 10px;
        --spacing-md: 20px;
        --spacing-lg: 30px;

        /* Border Radius */
        --radius-sm: 4px;
        --radius-md: 8px;

        /* Transitions */
        --transition: all 0.2s ease;
    }

    /* Base Styles */
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--bg);
        margin: 0;
        padding: var(--spacing-md);
        color: var(--text);
    }

    .container {
        max-width: 1000px;
        margin: 0 auto;
    }

    /* Header Components */
    header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-md);
        border-bottom: 2px solid var(--primary);
        padding-bottom: var(--spacing-sm);
    }

    h1 {
        margin: 0;
        font-size: 24px;
        color: var(--primary);
    }

    .back-link {
        font-size: 12px;
        color: var(--text-dim);
        text-decoration: none;
        margin-top: var(--spacing-xs);
        display: inline-block;
    }

    .back-link:hover {
        color: var(--primary);
    }

    .header-actions {
        display: flex;
        gap: var(--spacing-sm);
        align-items: center;
    }

    /* Authentication Box */
    .auth-box {
        /* No background or border - just contains the password input */
    }

    .auth-password-input {
        width: 120px;
        border: none;
        background: transparent;
        padding: 0;
        color: var(--text);
        font-family: monospace;
    }

    /* Loading Spinner */
    .spinner {
        display: inline-block;
        width: 18px;
        height: 18px;
        border: 4px solid var(--text-dim);
        border-top-color: var(--primary);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* Error/Success Messages */
    .error-box {
        display: none;
        background: var(--danger);
        color: white;
        padding: var(--spacing-sm);
        border-radius: var(--radius-sm);
        margin-bottom: 15px;
        font-weight: bold;
        cursor: pointer;
    }

    .success-message {
        color: var(--success);
    }

    .error-message {
        color: var(--danger);
    }

    /* Tab Components */
    .tab-bar {
        display: flex;
        gap: var(--spacing-xs);
        margin-bottom: var(--spacing-md);
        border-bottom: 2px solid var(--border);
    }

    .tab-button {
        padding: var(--spacing-sm) var(--spacing-md);
        background: var(--input-bg);
        color: var(--text-dim);
        border: none;
        border-radius: var(--radius-sm) var(--radius-sm) 0 0;
        cursor: pointer;
        font-weight: bold;
        border: 1px solid var(--border);
        border-bottom: none;
        transition: var(--transition);
    }

    .tab-button:hover {
        background: var(--card-bg);
        color: var(--text);
    }

    .tab-button.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    .tab-content {
        background: var(--card-bg);
        border-radius: var(--radius-md);
        border: 1px solid var(--border);
        padding: var(--spacing-md);
        min-height: 400px;
    }

    .tab-content.content-hidden {
        visibility: hidden;
    }

    /* Form Controls */
    input[type="text"],
    input[type="password"],
    select {
        padding: 8px;
        background: var(--input-bg);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        color: var(--text);
        font-family: monospace;
    }

    select {
        cursor: pointer;
    }

    input:focus,
    select:focus {
        outline: none;
        border-color: var(--primary);
    }

    input[type="checkbox"] {
        width: 16px;
        height: 16px;
        cursor: pointer;
    }

    input[type="checkbox"]:focus {
        outline: none;
        border-color: var(--primary);
    }

    label {
        color: var(--text-dim);
        font-weight: bold;
    }

    /* Buttons */
    button {
        padding: 8px 16px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: var(--radius-sm);
        cursor: pointer;
        font-weight: bold;
        transition: var(--transition);
    }

    button:hover {
        opacity: 0.8;
    }

    .btn-primary { background: var(--primary); }
    .btn-success { background: var(--success); }
    .btn-danger { background: var(--danger); }
    .btn-warning { background: var(--warning); }

    /* Control Groups */
    .control-group {
        display: flex;
        gap: var(--spacing-sm);
        align-items: center;
        margin-bottom: 15px;
    }

    .control-group label {
        color: var(--text-dim);
        font-weight: bold;
    }

    .control-group input {
        width: 100px;
    }

    /* Info/Status Boxes */
    .info-box {
        background: rgba(255, 255, 255, 0.05);
        padding: var(--spacing-sm);
        border-radius: var(--radius-sm);
        margin-bottom: 15px;
        font-size: 12px;
        color: var(--text-dim);
    }

    /* Console/Code Display */
    .console-display {
        background: #121416;
        color: #7fdbff;
        padding: 15px;
        border-radius: var(--radius-sm);
        font-family: monospace;
        font-size: 13px;
        white-space: pre;
        overflow-x: auto;
        margin-top: 15px;
        border: 1px solid #333;
    }

    .code-display {
        background: var(--input-bg);
        color: var(--text);
        padding: 15px;
        border-radius: var(--radius-sm);
        font-family: monospace;
        font-size: 13px;
        white-space: pre;
        overflow-x: auto;
        border: 1px solid var(--border);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        body {
            padding: var(--spacing-sm);
        }

        header {
            flex-direction: column;
            align-items: flex-start;
            gap: var(--spacing-sm);
        }

        .header-actions {
            width: 100%;
            justify-content: space-between;
        }

        .tab-bar {
            flex-wrap: wrap;
        }

        .control-group {
            flex-wrap: wrap;
        }
    }

    /* Content Disabled State - Used during script loading */
    .content-disabled {
        filter: grayscale(100%) brightness(0.8);
        opacity: 0.6;
        pointer-events: none;
    }

    /* Input Disabled State */
    .input-disabled {
        opacity: 0.4;
        pointer-events: none;
    }

    /* Modal Dialog Styles */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-dialog {
        background: var(--card-bg);
        border: 2px solid var(--border);
        border-radius: var(--radius-md);
        padding: var(--spacing-md);
        min-width: 400px;
        max-width: 600px;
    }

    .modal-instructions {
        color: var(--text-dim);
        font-size: 14px;
        margin-bottom: var(--spacing-sm);
    }

    .modal-textarea {
        width: 100%;
        height: 100px;
        background: var(--input-bg);
        color: var(--text);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        padding: 8px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        resize: vertical;
        margin-bottom: var(--spacing-md);
        box-sizing: border-box;
    }

    .modal-textarea:focus {
        outline: none;
        border-color: var(--primary);
    }

    .modal-buttons {
        display: flex;
        gap: var(--spacing-sm);
        justify-content: flex-end;
    }

    /* Card Styles */
    .card {
        background: var(--card-bg);
        border-radius: var(--radius-md);
        border: 1px solid var(--border);
        padding: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    .card-title {
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 15px;
        color: var(--primary);
        border-bottom: 1px solid var(--border);
        padding-bottom: 5px;
    }

    .card-subtitle {
        font-size: 13px;
        color: var(--text-dim);
        margin-bottom: 15px;
        font-style: italic;
    }

    /* Grid Layouts */
    .grid-7-3 {
        display: grid;
        grid-template-columns: 7fr 3fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    .grid-50-50 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    /* Foldable Section Styles */
    .foldable {
        margin-bottom: 15px;
    }

    .foldable-header {
        background: #2c3136;
        padding: 12px 15px;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: var(--primary);
        border: 1px solid var(--border);
        border-bottom: none;
        border-radius: var(--radius-md) var(--radius-md) 0 0;
    }

    .foldable-header:hover {
        background: #32383e;
    }

    .foldable-header .arrow {
        transition: transform 0.2s;
    }

    .foldable-header .spinner {
        display: none;
        margin-left: 10px;
    }

    .foldable-header .caption {
        color: var(--text-dim);
        font-weight: normal;
        font-size: 13px;
        margin-left: 5px;
    }

    .foldable-content {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-top: none;
        border-radius: 0 0 var(--radius-md) var(--radius-md);
        padding: 15px;
        display: none;
    }

    .foldable-content.loading {
        display: block;
        text-align: center;
        color: var(--text-dim);
        font-style: italic;
    }

    /* Status Item Styles */
    .status-grid {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .status-item {
        display: flex;
        justify-content: space-between;
        font-size: 14px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        padding: 6px 0;
    }

    .status-label {
        color: var(--text-dim);
        font-weight: bold;
    }

    .status-value {
        font-family: monospace;
        color: var(--text);
    }

    /* Button with Glyph */
    .btn-glyph {
        font-size: 16px;
        margin-right: 4px;
    }

    /* Tool Button */
    .tool-btn {
        padding: 12px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        text-align: center;
        text-decoration: none;
        display: block;
        transition: opacity 0.2s, transform 0.1s;
    }

    .tool-btn:hover {
        opacity: 0.8;
        transform: translateY(-1px);
    }

    .tool-btn:active {
        transform: translateY(0);
    }

    /* Tools Grid */
    .tools-grid {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 15px;
    }
    </style>

    <!-- Inline JS Scripts section -->

    <script>
    /* common-inline.js
     * No Concurrent File Load (sequential): CSS -> Fonts -> JS -> Favicon
     *
     * Per-page globals (define BEFORE this runs):
     *   var requiredFonts = [{ url, family, weight, style, display?, format? }, ...];
     *   var requiredCSS   = [{ url }, ...];
     *   var requiredJS    = [{ url }, ...];
     *   var contentItems  = ['.selector', ...];
     *
     * Optional:
     *   window.initializeApp()
     */

    (function () {
      'use strict';

      // ----------------------------
      // Defaults (if page forgets)
      // ----------------------------
      if (!Array.isArray(window.requiredFonts)) window.requiredFonts = [];
      if (!Array.isArray(window.requiredCSS)) window.requiredCSS = [];
      if (!Array.isArray(window.requiredJS)) window.requiredJS = [];
      if (!Array.isArray(window.contentItems)) window.contentItems = [];

      // ----------------------------
      // UI helpers
      // ----------------------------
      function showSpinner() {
        var spinner = document.getElementById('spinner');
        if (spinner) spinner.style.display = 'inline-block';
      }

      function hideSpinner() {
        var spinner = document.getElementById('spinner');
        if (spinner) spinner.style.display = 'none';
      }

      function disableContent() {
        window.contentItems.forEach(function (selector) {
          var elements = document.querySelectorAll(selector);
          elements.forEach(function(el) {
            el.classList.add('content-disabled');
          });
        });
      }

      function enableContent() {
        window.contentItems.forEach(function (selector) {
          var elements = document.querySelectorAll(selector);
          elements.forEach(function(el) {
            el.classList.remove('content-disabled');
            el.classList.remove('content-hidden');
          });
        });
      }

      function showCriticalError(message, fileUrl) {
        hideSpinner(); // keep content disabled

        var text = '❌ ' + message + (fileUrl ? (' (' + fileUrl + ')') : '') + ' Please reload.';

        var host = document.querySelector('.header-actions') || document.body;

        var existing = document.getElementById('critical-error-inline');
        if (existing) {
          existing.textContent = text;
          return;
        }

        var span = document.createElement('span');
        span.id = 'critical-error-inline';
        span.textContent = text;
        span.style.cssText =
          'color:#e74c3c;font-weight:bold;font-size:14px;margin-right:25px;';

        if (host.firstChild) host.insertBefore(span, host.firstChild);
        else host.appendChild(span);
      }

      // Optional exports
      window.showSpinner = showSpinner;
      window.hideSpinner = hideSpinner;
      window.disableContent = disableContent;
      window.enableContent = enableContent;
      window.showCriticalError = showCriticalError;

      // ----------------------------
      // Favicon stage (best-effort, last)
      // ----------------------------

      function ensurePlaceholderFaviconLink() {
        var link = document.getElementById('app-favicon');
        if (!link) {
          link = document.createElement('link');
          link.id = 'app-favicon';
          link.rel = 'icon';
          document.head.appendChild(link);
        }
        if (!link.href) link.href = 'data:,';
        return link;
      }

      function setFaviconHref(url) {
        var link = ensurePlaceholderFaviconLink();
        link.href = url;
      }

      // Best-effort: if favicon.ico exists next to the HTML file, set it.
      // Do nothing on any failure.
      function tryLoadFaviconLast() {
        // Skip on file:// protocol (CORS blocks fetch)
        if (window.location.protocol === 'file:') {
          return Promise.resolve();
        }

        ensurePlaceholderFaviconLink();

        var url = 'favicon.ico';

        // Use HEAD probe to avoid downloading it; fallback to GET if HEAD fails.
        return fetch(url, { method: 'HEAD', cache: 'no-store' })
          .then(function (r) {
            if (r && r.ok) setFaviconHref(url);
          })
          .catch(function () {
            return fetch(url, { method: 'GET', cache: 'no-store' })
              .then(function (r) {
                if (r && r.ok) setFaviconHref(url);
              })
              .catch(function () { /* ignore */ });
          });
      }

      // ----------------------------
      // Sequential loaders
      // ----------------------------

      function loadCSSSequential(list) {
        if (!list.length) return Promise.resolve();

        var i = 0;

        function next() {
          if (i >= list.length) return Promise.resolve();

          var item = list[i++];
          var url = item && item.url;

          if (!url) {
            return Promise.reject({ stage: 'css', url: null, error: new Error('Invalid CSS spec') });
          }

          return new Promise(function (resolve, reject) {
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = url;

            link.onload = function () { resolve(); };
            link.onerror = function () { reject(new Error('CSS load error')); };

            document.head.appendChild(link);
          }).then(next).catch(function (e) {
            return Promise.reject({ stage: 'css', url: url, error: e });
          });
        }

        return next();
      }

      function loadFontsSequential(list) {
        if (!list.length) return Promise.resolve();

        if (!('FontFace' in window) || !document.fonts) {
          // Non-fatal: allow fallback fonts
          return Promise.resolve();
        }

        var i = 0;

        function next() {
          if (i >= list.length) return Promise.resolve();

          var f = list[i++];
          if (!f || !f.url || !f.family) {
            return Promise.reject({ stage: 'font', url: (f && f.url) || null, error: new Error('Invalid font spec') });
          }

          var descriptors = {
            weight: f.weight || 'normal',
            style: f.style || 'normal'
          };
          if (f.display) descriptors.display = f.display;

          var face = new FontFace(
            f.family,
            "url('" + f.url + "')" + (f.format ? (" format('" + f.format + "')") : ''),
            descriptors
          );

          return face.load().then(function (loaded) {
            document.fonts.add(loaded);
            return next();
          }).catch(function (e) {
            return Promise.reject({ stage: 'font', url: f.url, error: e });
          });
        }

        return next();
      }

      function loadJSSequential(list) {
        if (!list.length) return Promise.resolve();

        var i = 0;

        function next() {
          if (i >= list.length) return Promise.resolve();

          var item = list[i++];
          var url = item && item.url;

          if (!url) {
            return Promise.reject({ stage: 'js', url: null, error: new Error('Invalid JS spec') });
          }

          return new Promise(function (resolve, reject) {
            var script = document.createElement('script');
            script.src = url;

            var hadErrorForThisScript = false;

            function onWindowError(event) {
              if (event && event.filename && event.filename.indexOf(url) !== -1) {
                hadErrorForThisScript = true;
              }
            }

            window.addEventListener('error', onWindowError);

            script.onload = function () {
              setTimeout(function () {
                window.removeEventListener('error', onWindowError);
                if (hadErrorForThisScript) reject(new Error('JS syntax/runtime error'));
                else resolve();
              }, 50);
            };

            script.onerror = function () {
              window.removeEventListener('error', onWindowError);
              reject(new Error('JS network error'));
            };

            document.head.appendChild(script);
          }).then(next).catch(function (e) {
            return Promise.reject({ stage: 'js', url: url, error: e });
          });
        }

        return next();
      }

      // ----------------------------
      // Orchestrator + boot
      // ----------------------------

      function loadAllSequentially() {
        // Favicon is last and best-effort: never fails the pipeline.
        return loadCSSSequential(window.requiredCSS)
          .then(function () { return loadFontsSequential(window.requiredFonts); })
          .then(function () { return loadJSSequential(window.requiredJS); })
          .then(function () { return tryLoadFaviconLast().catch(function () { /* ignore */ }); });
      }

      function startPageLoad() {
        showSpinner();
        disableContent();

        loadAllSequentially()
          .then(function () {
            hideSpinner();
            enableContent();

            if (typeof window.initializeApp === 'function') {
              window.initializeApp();
            }
          })
          .catch(function (info) {
            var stage = (info && info.stage) ? info.stage : 'unknown';
            var url = (info && info.url) ? info.url : null;

            showCriticalError('Failed to load local ' + stage + ' resource.', url);
            console.error('Critical load failure:', info);
          });
      }

      if (window.jQuery && typeof window.jQuery === 'function') {
        jQuery(document).ready(function () {
          setTimeout(startPageLoad, 25);
        });
      } else {
        document.addEventListener('DOMContentLoaded', function () {
          setTimeout(startPageLoad, 25);
        });
      }
    })();
    </script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div>
                <h1>Tool Title</h1>
                <a href="/" class="back-link">← Back to Control Panel</a>
            </div>
            <div class="header-actions">
                <span id="spinner" class="spinner" style="display:none;"></span>
                <button id="refreshBtn" class="btn-success">Refresh</button>
                <div class="auth-box">
                    <form autocomplete="on">
                        <input type="text" name="username" value="ultimate-api" autocomplete="username" style="display: none;">
                        <input type="password" id="apiPassword" name="password" placeholder="API Password" autocomplete="current-password" class="auth-password-input">
                    </form>
                </div>
            </div>
        </header>

        <!-- Error Box -->
        <div id="errorBox" class="error-box"></div>

        <!-- Tab Bar (optional - remove if not needed) -->
        <!--
        <div class="tab-bar content-disabled">
            <button class="tab-button active" data-tab="tab1">Tab 1</button>
            <button class="tab-button" data-tab="tab2">Tab 2</button>
        </div>
        -->

        <!-- Page Content -->
        <div class="tab-content content-disabled">
            <!-- Add your tool content here -->
        </div>
    </div>

    <script>
    // ============================================================================
    // TOOL-SPECIFIC JAVASCRIPT
    // ============================================================================
    // Add your tool's JavaScript code here
    //
    // Define window.initializeApp = function() { ... } to run code after
    // all scripts and styles have loaded.
    //
    // See SHARED_LIBRARIES.md for available utility functions.
    // See Tab_Lifecycle_Pattern.md for multi-tab interface patterns.
    //
    // Example:
    //
    // window.initializeApp = function() {
    //     console.log('Tool initializing...');
    //
    //     // Initialize tab system
    //     initializeTabs(tabMap, 'tab0');
    //
    //     // Set up your tool here
    // };
    </script>
</body>
</html>
